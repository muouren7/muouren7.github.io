<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Node.js学习与MongoDB快速上手 | muouren7のBlog</title>

<link rel="shortcut icon" href="https://muouren7.github.io/favicon.ico?v=1665903129413">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://muouren7.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            muouren7のBlog
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1665903129413"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Node.js学习与MongoDB快速上手
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-10-14 ·
                    </time>
                    
                        <a href="https://muouren7.github.io/tag/4MOv9mgta/" class="post-tags">
                            # nodejs
                        </a>
                    
                        <a href="https://muouren7.github.io/tag/tIUfW5Uual/" class="post-tags">
                            # 笔记
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="nodejs简易入门">Node.js简易入门</h1>
<h2 id="1-http库">1、http库</h2>
<pre><code class="language-javascript">//导入http库
const http = require(&quot;http&quot;);
const url = require(&quot;url&quot;);
//创建服务
http.createServer(function(request,response){
    console.log(request.url);
    //设置响应头
    response.writeHead(200,{&quot;Content-Type&quot;:&quot;text/html&quot;});
    //在页面上输出一句话，并结束响应
    response.write(&quot;&lt;h1&gt;hello world&lt;/h1&gt;&quot;);
    //过滤url中的图标请求
    if(request.url != &quot;/favicon.ico&quot;){
        if(request.url == &quot;get&quot;){
            var quer = url.parse(request.url,true).query;
            var b = quer.a;
            console.log(typeof(b));
        }
    }
    if(request.url == &quot;/test&quot;){
        console.log(&quot;this is my test 111&quot;);
    }
    if(request.url == &quot;/text&quot;){
        response.write(&quot;ready to text&quot;);
        //console.log(&quot;ready to text&quot;);
    }
    response.end(&quot;&lt;h1&gt;hello world&lt;/h1&gt;&quot;);
}).listen(8081);//监听8081端口

console.log(&quot;Server running at http://127.0.0.1:8081/&quot;);
</code></pre>
<h2 id="2-async与awaitpromise">2、async与await，Promise</h2>
<p>node.js中许多操作都是异步操作，而异步操作中的数据不能直接进行retrurn，异步操作中的数据可封装成Promise再进行返回，同时结合async，await关键字操作。如下：</p>
<pre><code class="language-javascript">const { rejects } = require(&quot;assert&quot;);
const fs = require(&quot;fs&quot;);
const { resolve } = require(&quot;path&quot;);

function a(filename){
    
    return new Promise((resolve,rejects)=&gt;{	//resolve为正常情况的返回数据，rejects为函数出错情况下的返回数据
        //fs.readFile是异步操作，将其封装成Promise，这样子后a()也是一个异步函数
        fs.readFile(&quot;./static/&quot;+filename,(err,data)=&gt;{
            //如果读取文件出错,保存rejects
            if(err){
                console.log(err);
                rejects(err);
                return;
            }
            //无误保存resolve
            resolve(data);
        })
    });
}

async function getA(){
    // a()是异步函数，await的作用是等待a()内部的操作执行完再进行下一步操作，需要配合async关键字才能使用
    var data = await a(&quot;test.txt&quot;);
    console.log(data.toString());
}
getA();
</code></pre>
<h2 id="3-粗糙的静态web服务器">3、粗糙的静态web服务器</h2>
<p>使用<strong>exports.模块名</strong>进行导出，以便在其他文件下可以调用<br>
<strong>common.js文件</strong></p>
<pre><code class="language-javascript">exports.getMine = function(filename){
    switch(filename){
        case &quot;.html&quot;:
            return 'text/html';
        case &quot;.css&quot;:
            return 'text/css';
        case &quot;.js&quot;:
            return 'text/javascript';
        default:
            return 'text/html';
    }
}
</code></pre>
<p><strong>服务器文件</strong></p>
<pre><code class="language-javascript">const http = require(&quot;http&quot;);
const fs = require(&quot;fs&quot;);
const common = require(&quot;./common.js&quot;);
const path = require(&quot;path&quot;);
//创建服务
http.createServer(function(req,resp){
    //获取url中访问的路径
    var filename = req.url;
    if(filename == &quot;/&quot;){
        filename = &quot;/index.html&quot;;
    }

    var extname = path.extname(filename);

    if(filename != &quot;/favicon.ico&quot;){
        console.log(filename)
        fs.readFile(&quot;static&quot;+filename,function(err,data){
            //如果文件读取失败，返回一下文字
            if(err){
                resp.writeHead(404,{&quot;Content-Type&quot;:&quot;text/plain;charset=utf-8&quot;});
                resp.end(&quot;您访问的页面不存在&quot;);
            }
            //如果文件读取成功，返回文件内容以及对应的响应格式
            let mine = common.getMine(extname);
            resp.writeHead(200,{&quot;Content-Type&quot;:mine+&quot;;charset=utf-8&quot;});
            resp.end(data);
        })
    }


}).listen(8081);
</code></pre>
<h2 id="4-post表单数据获取">4、post表单数据获取</h2>
<p>在node中获取post数据使用到以下中间件</p>
<pre><code class="language-javascript">const express = require(&quot;express&quot;)	

var app = new express()
app.use(express.json())			//设置接收axios applicate/json类型	实测没用，最好还是确保类型是application/x-www-form-urlencoded

app.use(express.urlencoded({extended:false}))		//自动将post参数转换为对象


/***
***	示例如下
***
***/
app.post(&quot;/updata&quot;,(req,resp)=&gt;{
    let msg = req.body[&quot;msg&quot;]
    resp.send(&quot;您提交的信息是:&quot;+msg)
})
</code></pre>
<p>html中的代码</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;http://127.0.0.1:8001/updata&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;msg&quot;&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="5-cookie的获取">5、cookie的获取</h2>
<p>cookie的获取也需要导入<strong>cookie-parser</strong>的模块</p>
<pre><code class="language-javascript">const cookieParser = require(&quot;cookie-parser&quot;)

var app = express()
app.use(cookieParser())

/**
	其中，resp.cookie中{}包含以下参数
	maxAge：cookie有效时间，单位毫秒
	
**/

app.get('/chick',function(req,resp){
	resp.cookie(&quot;username&quot;,&quot;张三&quot;,{maxAge:1000*60*60})	//第三位参数是cookie的有效时间，单位毫秒(ms)
	resp.send(&quot;cookie已经添加&quot;)
})


app.get(&quot;/getcookie&quot;,function(req,resp){
    //console.log(req.cookies[&quot;username&quot;])
    console.log(req.cookies)
    resp.send(&quot;你好&quot;)
    //resp.send(&quot;您的cookie是:&quot;+req.cookies.username)
})
</code></pre>
<p><strong>加密cookie</strong>，作用：用于传递一些中文cookie，先加密，需要的时候解密</p>
<pre><code class="language-javascript">const cookieParser = require(&quot;cookie-parser&quot;)
//配置cookieParser中间件
app.use(cookieParser(&quot;abcdef&quot;))		//传入加密密钥

//加密设置
app.get(&quot;/setcookie&quot;,(req,res)=&gt;{
    res.cookie(&quot;username&quot;,&quot;muouren7&quot;,{maxAge:1000*60*60,signed:true})
})

//获取加密后的cookie
app.get(&quot;getcookie&quot;,(req,res)=&gt;{
    console.log(req.signedCookies[&quot;username&quot;])
})
</code></pre>
<h2 id="6-跨域">6、跨域</h2>
<pre><code class="language-javascript">//设置允许跨域访问该服务
app.all('*',function(req,res,next){
    res.header(&quot;Access-Control-Allow-Origin&quot;,&quot;http://localhost:8081&quot;);		//放行的域
    res.header(&quot;Access-Control-Allow-Methods&quot;,&quot;PUT,GET,POST,DELETE,OPTIONS&quot;);	//放行的方法
    res.header(&quot;Access-Control-Allow-Headers&quot;,&quot;X-Requestd-With&quot;);	
    res.header(&quot;Access-Control-Allow-Headers&quot;,&quot;Content-Type&quot;);	
    res.header(&quot;Access-Control-Allow-Credentials&quot;,true);			//是否可以传递cookie，如果为true，那么第一项里必须为具体的域名，不能为*
    next()
});
</code></pre>
<h2 id="7-session的使用">7、session的使用</h2>
<p>首先需要安装<strong>express-session</strong>的包</p>
<pre><code class="language-shell">npm install express-session --save
</code></pre>
<p>引入包</p>
<pre><code class="language-javascript">const session = require(&quot;express-session&quot;)
</code></pre>
<p>设置官方文档提供的中间件</p>
<pre><code class="language-javascript">app.use(session({
    secret:'keyboard cat',		//服务端生成session的签名，里面的字符串随便写
    name:&quot;session_id&quot;,			//修改cookie中对应session-key的名称
    resave:true,				//强制保存session
    saveUninitialized:true,		//强制将未初始化的session存储
    cookie:{
        maxAge:1000*60*60,	
        secure:false		//true表示只有https连接才能访问session		
    },
    rolling:true		//每次登录重新把cookie的过期时间设置为maxAge
}))
</code></pre>
<p>session的使用</p>
<pre><code class="language-javascript">// 设置session
app.get(&quot;/setsession&quot;,(req,res)=&gt;{
    req.session.username = &quot;muouren7&quot;;
    res.send(&quot;session已经存储&quot;)
})
//获取session
app.get(&quot;/getsession&quot;,(req,res)=&gt;{
    let name = req.session.username;
    res.send(&quot;您的session是---&quot;+name)
})

//销毁session
app.get(&quot;/destroySession&quot;,(req,res)=&gt;{
    //方法1 将保存session的cookie时间设置为0，销毁全部session
    req.session.cookie.maxAge = 0

    //方法2 销毁指定session
    req.session.username = &quot;&quot;

    //方法3 destroy
    req.session.destroy()

})
</code></pre>
<h2 id="8-将session保存在mongodb">8、将session保存在mongoDB</h2>
<p>导入<strong>connect-mongo</strong>的包</p>
<pre><code class="language-javascript">const session = require(&quot;express-session&quot;)
const MongoStore = require(&quot;connect-mongo&quot;)(session)

app.user(session({
    store: MongoStore.create({
        url:&quot;你的mongoDb数据库地址&quot;,
        touchAfter:24*60*60				//不管发出多少请求，24小时内只更新一次session
    })
}))
</code></pre>
<h2 id="9-路由模块化">9、路由模块化</h2>
<p>将单个js文件内的路由拆分成多个js文件，可以理解为模块化<br>
主文件<strong>app.js</strong></p>
<pre><code class="language-javascipt">const express = require(&quot;express&quot;)
var app = express()

//引入模块admin.js，这里admin.js与app.js位于同一级目录下
var admin = require(&quot;admin&quot;)
//配置中间件
app.use(&quot;/admin&quot;,admin)

app.listen(8080,()=&gt;{
    console.log(&quot;已经在端口8080开启服务&quot;);
})
</code></pre>
<p>模块文件<strong>admin.js</strong></p>
<pre><code class="language-javascript">const express = require(&quot;express&quot;)

var router = express.Router()

//url:http:127.0.0.1:8080/admin
router.get(&quot;/&quot;,(req,res)=&gt;{
    res.send(&quot;您已来到管理员模块&quot;)
})

//url:http:127.0.0.1:8080/admin/manage
router.get(&quot;/manage&quot;,(req,res)=&gt;{
    res.send('您正在管理admin模块')
})

//
module.exports = router
</code></pre>
<h2 id="10-结合multer上传图片">10、结合multer上传图片</h2>
<p>安装<strong>multer</strong></p>
<pre><code class="language-shell">npm install --save multer
</code></pre>
<p>html代码如下，form表单中格式必须为<strong>multipart/form-data</strong></p>
<pre><code class="language-javascript">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;http://127.0.0.1:8080/profile&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        &lt;input type=&quot;file&quot; name=&quot;pic&quot; &gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>app.js</strong>中代码如下</p>
<pre><code class="language-javascript">const multer = require(&quot;multer&quot;)
const path = require(&quot;path&quot;)

const storage = multer.diskStorage({
    //配置文件上传位置
    destination: function (req, file, cb) {
        cb(null, '/static/files')
    },
    //修改上传文件的后缀名
    filename: function (req, file, cb) {
        //获取后缀名
        let extname = path.extname(file[&quot;originalname&quot;])
        //设置后缀名
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9)
        cb(null, file.fieldname + '-' + uniqueSuffix + extname)
    }
})
const upload = multer({ storage: storage })

app.post(&quot;/profile&quot;,upload.single('pic'),(req,res,nex)=&gt;{
    console.log(req.file)
    res.send(req.file)
})
</code></pre>
<h2 id="11-nodejs连接mongodb">11、node.js连接mongoDB</h2>
<p>如下</p>
<pre><code class="language-javascript">const MongoClinet = require(&quot;mongodb&quot;).MongoClient
const DataBaseUrl = &quot;mongodb://127.0.0.1:27017/&quot;		//mongoDB数据库地址
var app = express()

app.get('/chick',function(req,resp){
    let parse = url.parse(req.url)
    let name = parse.query.split(&quot;=&quot;)[1]
    MongoClinet.connect(DataBaseUrl,function(err,db){
        if(err){
            console.log(&quot;数据库连接错误&quot;);
        }
        let dbo = db.db(&quot;itying&quot;)
        let data = {&quot;name&quot;:unescape(name)}
        let msg = dbo.collection(&quot;user&quot;).find(data).toArray((err,result)=&gt;{
            if(err){
                console.log(&quot;查询出错&quot;)
            }
            resp.cookie(&quot;username&quot;,result[0][&quot;name&quot;],{maxAge:1000*60*60})
            resp.send(result)
            db.close()
        })
    })
})
</code></pre>
<h1 id="mongoose使用">Mongoose使用</h1>
<h2 id="1-demo">1、Demo</h2>
<pre><code class="language-javascript">const mongoose = require(&quot;mongoose&quot;)

mongoose.connect(&quot;mongodb://127.0.0.1:27017/itying&quot;)  //把数据库名字也加上
//操作users表 定义一个Schema
var UserSchema = mongoose.Schema({
    name:String,
    age:Number,
    status,Number
})
//定义model，第一个参数（表名必须为第一个参数的复数形式，且参数首字母必须大写），第二参数为定义的Schema，第三个参数（如果有，则对应此参数对应的集合，没有则是以第一个参数为准）
var User = mongoose.model('User',UserSchema,&quot;users&quot;)
//查询users集合的数据，第一个参数为过滤条件
User.find({},(err,doc)=&gt;{
    if(err){
        console.log(err)
    	return;
    }
    console.log	(doc)
})
</code></pre>
<h2 id="2-增加一条数据">2、增加一条数据</h2>
<pre><code class="language-javascript">var u = new User({
    name:&quot;muouren7&quot;,
    age:22
})
u.save((err,msg)=&gt;{
    if(err){
        console.log(&quot;err:&quot;+err)
        return
    }
    if(msg){
        console.log(&quot;msg:&quot;+msg)
    }
})    //执行增加操作，回调函数可加可不加，msg为user的json数据
</code></pre>
<h2 id="3-查询数量">3、查询数量</h2>
<pre><code class="language-javascript">//2、查询users表数量，第一个{}中为过滤条件
User.countDocuments({},(err,num)=&gt;{
    if(err){
        console.log(err)
        return
    }
    console.log(&quot;返回值是:&quot;+num)
})
</code></pre>
<h2 id="4-修改数据记录">4、修改数据记录</h2>
<pre><code class="language-javascript">//4、修改数据记录，参数1表示修改的条件，参数2表示修改的内容
//例：将名字为张三的改为张三1234
User.updateOne({name:&quot;张三&quot;},{name:&quot;张三1234&quot;},(err,res)=&gt;{
    if(err){
        console.log(err)
        return
    }
    console.log(res)
})
</code></pre>
<h2 id="5-删除数据">5、删除数据</h2>
<pre><code class="language-javascript">// 5、删除记录
User.deleteOne({name:&quot;zhangsan&quot;},(err,res)=&gt;{
    if(err){
        console.log(err)
    }
    console.log(res)
    console.log(&quot;删除成功&quot;)
})
</code></pre>
<h1 id="mongodb">MongoDB</h1>
<h2 id="1-数据库的创建-使用">1、数据库的创建、使用</h2>
<p>在cmd下运行，直接切换到数据库不能创建成功，必须插入一条数据</p>
<pre><code class="language-shell">use itying 		###创建名为itying的数据库
</code></pre>
<p>往itying数据库的user集合里插入一条数据（集合不用创建，直接操作）</p>
<pre><code class="language-shell">use itying		###切换到itying数据库下
db.user.insert({&quot;name&quot;:&quot;xiaoming&quot;,&quot;age&quot;:20});

show collections	###展示当前数据库里所有的集合
db.user.find()		###展示user集合下的数据

show dbs	### 展示当前所有的数据库
</code></pre>
<h2 id="2-删除集合">2、删除集合</h2>
<pre><code class="language-shell">### 切换到itying数据库下
use itying
###删除user集合
db.user.drop()
</code></pre>
<h2 id="3-删除数据库">3、删除数据库</h2>
<pre><code class="language-shell">### 切换到itying数据库下
use itying
### 删除当前数据库
db.dropDatabase()
</code></pre>
<h2 id="4-插入数据">4、插入数据</h2>
<pre><code class="language-shell">db.表名.insert({&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:20});
</code></pre>
<h2 id="5-查询">5、查询</h2>
<pre><code class="language-shell">###	1、查询所有记录
db.user.find()

###	2、查找age=22的数据
db.user.find({&quot;age&quot;:22})

###	3、查询age&gt;22的记录
db.user.find({age:{$gt:22}})

###	4、查询age&lt;22的记录
db.user.find({age:{$lt:22}})

###	5、查询age&gt;=25的记录
db.user.find({age:{$gte:25}})

###	6、查询age&lt;=25的记录
db.user.find({age:{$lte:25}})

###	7、查询age&gt;=23 并且 age&lt;=26
db.user.find({age:{$gte:23,$lte:26}})

###	8、查询name中包含mongo的数据	模糊查询
db.user.find({name:/mongo/})

###	9、查询name中以mongo开头的数据
db.user.find({name:/^mongo/})

###	10、查询指定列,只显示name，不显示age，第一个{}为条件参数
db.user.find({age:{$lte:25}},{name:1})

### 11、按照年龄排序，1：升序	2：降序
db.user.find().sort({age:1})

### 12、查询前5条数据
db.user.find().limit(5)

###	13、查询10条以后的数据
db.user.find().skip(10)

### 14、查询5-10之间的数据
db.user.find().limit(10).skip(5)

### 15、or查询,查22或者25
db.user.find({$or:[{age:22},{age:25}]})

### 16、统计age&gt;25的个数
db.user.find({age:{$gt:25}}).count()
</code></pre>
<h2 id="6-修改">6、修改</h2>
<pre><code class="language-shell">###	1、把名字叫做小明的年龄改为16
db.user.update({&quot;name&quot;:&quot;小明&quot;},{$set:{&quot;age&quot;:16}})
</code></pre>
<h2 id="7-删除">7、删除</h2>
<pre><code class="language-shell">### 1、删除age为26的
db.user.remove({age:26})
</code></pre>
<h2 id="8-设置索引与复合索引面临海量数据时提升查询速度">8、设置索引与复合索引（面临海量数据时提升查询速度）</h2>
<pre><code class="language-shell">###	对username字段设置索引，1：升序		2：降序
db.user.ensureIndex({&quot;username&quot;:1})
db.user.createIndex({&quot;username&quot;:1})		##新版mongo命令

###	获取当前已经设置的索引
db.user.getIndexes()

###	删除索引
db.user.dropIndex({&quot;username&quot;:1})

### 复合索引
db.user.ensureIndex({&quot;usernam&quot;:1,&quot;age&quot;:-1})

###	设置唯一索引（必须唯一）
db.user.exsureIndex({&quot;userid&quot;:1},{&quot;unique&quot;:true})		###	设置userid为唯一索引，数据库中不能存在相同的userid
</code></pre>
<h2 id="9-mongo权限配置">9、mongo权限配置</h2>
<p>1、创建超级管理员用户</p>
<pre><code class="language-shell">use admin
db.createUser({
	user:'admin',
	pwd:'123456',
	roles:[{role:'root',db:'admin'}]
})
</code></pre>
<p>2、修改mongodb安装目录下的配置文件mongod.cfg文件，添加以下配置，开启连接验证，然后重启mongodb服务</p>
<pre><code class="language-shell">security:
	authorization: enabled;
</code></pre>
<p>3、用超级管理员用户密码连接数据库</p>
<pre><code class="language-shell">mongo admin -u 用户名 -p 密码
mongo 127.0.0.1:27017/test -u user -p pwd
</code></pre>
<p>4、给eggcms数据库创建一个用户，只能访问eggcms不能访问其他数据库</p>
<pre><code class="language-shell">user eggcms
db.createUser({
	user:'eggadmin',
	pwd:'123456',
	roles:[{role:'dbOwner',db:'eggcms'}]
})
</code></pre>
<h2 id="mongodb数据库角色">MongoDb数据库角色</h2>
<p>1、数据库用户角色：read、readWrite<br>
2、数据库管理角色：dbAdmin、dbOwner、userAdmin</p>
<p>3、集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager</p>
<p>4、备份恢复角色：backup、restore</p>
<p>5、所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</p>
<p>6、超级用户：root</p>
<pre><code class="language-shell">### 查看当前库下的管理员
show user

###	删除用户
db.dropUser(&quot;eggadmin&quot;)

###	修改用户密码
db.updateUser(&quot;admin&quot;,{pwd:'password'})

### 密码认证
db.auth(&quot;admin&quot;,&quot;password&quot;)

</code></pre>

                </div>
            </article>
        </div>

        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">温故而知新</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://muouren7.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
