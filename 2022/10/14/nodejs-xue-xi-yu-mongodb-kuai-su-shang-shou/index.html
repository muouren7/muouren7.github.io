<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="there is nothing">
    <meta property="og:type" content="website">
    <meta name="description" content="there is nothing">
    <meta name="keyword"  content="神秘">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        Node.js学习与MongoDB快速上手 - muouren7のBlog
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 向所有抗争不公命运的力量 致敬！！ </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/IMG/pro.png" />
        </div>
        <div class="name">
            <i>muouren7</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>收藏</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Node-js%E7%AE%80%E6%98%93%E5%85%A5%E9%97%A8"><span class="toc-text">Node.js简易入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81http%E5%BA%93"><span class="toc-text">1、http库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81async%E4%B8%8Eawait%EF%BC%8CPromise"><span class="toc-text">2、async与await，Promise</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%B2%97%E7%B3%99%E7%9A%84%E9%9D%99%E6%80%81web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">3、粗糙的静态web服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81post%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-text">4、post表单数据获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81cookie%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-text">5、cookie的获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E8%B7%A8%E5%9F%9F"><span class="toc-text">6、跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81session%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">7、session的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%B0%86session%E4%BF%9D%E5%AD%98%E5%9C%A8mongoDB"><span class="toc-text">8、将session保存在mongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-text">9、路由模块化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E7%BB%93%E5%90%88multer%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87"><span class="toc-text">10、结合multer上传图片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81node-js%E8%BF%9E%E6%8E%A5mongoDB"><span class="toc-text">11、node.js连接mongoDB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mongoose%E4%BD%BF%E7%94%A8"><span class="toc-text">Mongoose使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Demo"><span class="toc-text">1、Demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%A2%9E%E5%8A%A0%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE"><span class="toc-text">2、增加一条数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%9F%A5%E8%AF%A2%E6%95%B0%E9%87%8F"><span class="toc-text">3、查询数量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95"><span class="toc-text">4、修改数据记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-text">5、删除数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB"><span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E4%BD%BF%E7%94%A8"><span class="toc-text">1、数据库的创建、使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%88%A0%E9%99%A4%E9%9B%86%E5%90%88"><span class="toc-text">2、删除集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">3、删除数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">4、插入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%9F%A5%E8%AF%A2"><span class="toc-text">5、查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E4%BF%AE%E6%94%B9"><span class="toc-text">6、修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%88%A0%E9%99%A4"><span class="toc-text">7、删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E8%AE%BE%E7%BD%AE%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%88%E9%9D%A2%E4%B8%B4%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E6%97%B6%E6%8F%90%E5%8D%87%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6%EF%BC%89"><span class="toc-text">8、设置索引与复合索引（面临海量数据时提升查询速度）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81mongo%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE"><span class="toc-text">9、mongo权限配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDb%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%92%E8%89%B2"><span class="toc-text">MongoDb数据库角色</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 向所有抗争不公命运的力量 致敬！！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        Node.js学习与MongoDB快速上手
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2022-10-14 15:06:25</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#笔记" title="笔记">笔记</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#nodejs" title="nodejs">nodejs</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h1 id="Node-js简易入门"><a href="#Node-js简易入门" class="headerlink" title="Node.js简易入门"></a>Node.js简易入门</h1><h2 id="1、http库"><a href="#1、http库" class="headerlink" title="1、http库"></a>1、http库</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入http库</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">//创建服务</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">request,response</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="comment">//设置响应头</span></span><br><span class="line">    response.<span class="title function_">writeHead</span>(<span class="number">200</span>,&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;text/html&quot;</span>&#125;);</span><br><span class="line">    <span class="comment">//在页面上输出一句话，并结束响应</span></span><br><span class="line">    response.<span class="title function_">write</span>(<span class="string">&quot;&lt;h1&gt;hello world&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//过滤url中的图标请求</span></span><br><span class="line">    <span class="keyword">if</span>(request.<span class="property">url</span> != <span class="string">&quot;/favicon.ico&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(request.<span class="property">url</span> == <span class="string">&quot;get&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> quer = url.<span class="title function_">parse</span>(request.<span class="property">url</span>,<span class="literal">true</span>).<span class="property">query</span>;</span><br><span class="line">            <span class="keyword">var</span> b = quer.<span class="property">a</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">typeof</span>(b));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(request.<span class="property">url</span> == <span class="string">&quot;/test&quot;</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;this is my test 111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(request.<span class="property">url</span> == <span class="string">&quot;/text&quot;</span>)&#123;</span><br><span class="line">        response.<span class="title function_">write</span>(<span class="string">&quot;ready to text&quot;</span>);</span><br><span class="line">        <span class="comment">//console.log(&quot;ready to text&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    response.<span class="title function_">end</span>(<span class="string">&quot;&lt;h1&gt;hello world&lt;/h1&gt;&quot;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8081</span>);<span class="comment">//监听8081端口</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Server running at http://127.0.0.1:8081/&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="2、async与await，Promise"><a href="#2、async与await，Promise" class="headerlink" title="2、async与await，Promise"></a>2、async与await，Promise</h2><p>node.js中许多操作都是异步操作，而异步操作中的数据不能直接进行retrurn，异步操作中的数据可封装成Promise再进行返回，同时结合async，await关键字操作。如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; rejects &#125; = <span class="built_in">require</span>(<span class="string">&quot;assert&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">filename</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,rejects</span>)=&gt;</span>&#123;	<span class="comment">//resolve为正常情况的返回数据，rejects为函数出错情况下的返回数据</span></span><br><span class="line">        <span class="comment">//fs.readFile是异步操作，将其封装成Promise，这样子后a()也是一个异步函数</span></span><br><span class="line">        fs.<span class="title function_">readFile</span>(<span class="string">&quot;./static/&quot;</span>+filename,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">//如果读取文件出错,保存rejects</span></span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">                <span class="title function_">rejects</span>(err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//无误保存resolve</span></span><br><span class="line">            <span class="title function_">resolve</span>(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getA</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// a()是异步函数，await的作用是等待a()内部的操作执行完再进行下一步操作，需要配合async关键字才能使用</span></span><br><span class="line">    <span class="keyword">var</span> data = <span class="keyword">await</span> <span class="title function_">a</span>(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">toString</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getA</span>();</span><br></pre></td></tr></table></figure>
<h2 id="3、粗糙的静态web服务器"><a href="#3、粗糙的静态web服务器" class="headerlink" title="3、粗糙的静态web服务器"></a>3、粗糙的静态web服务器</h2><p>使用<strong>exports.模块名</strong>进行导出，以便在其他文件下可以调用<br><strong>common.js文件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">getMine</span> = <span class="keyword">function</span>(<span class="params">filename</span>)&#123;</span><br><span class="line">    <span class="keyword">switch</span>(filename)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;.html&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;text/html&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;.css&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;text/css&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;.js&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;text/javascript&#x27;</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;text/html&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>服务器文件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&quot;./common.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">//创建服务</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">req,resp</span>)&#123;</span><br><span class="line">    <span class="comment">//获取url中访问的路径</span></span><br><span class="line">    <span class="keyword">var</span> filename = req.<span class="property">url</span>;</span><br><span class="line">    <span class="keyword">if</span>(filename == <span class="string">&quot;/&quot;</span>)&#123;</span><br><span class="line">        filename = <span class="string">&quot;/index.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extname = path.<span class="title function_">extname</span>(filename);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(filename != <span class="string">&quot;/favicon.ico&quot;</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(filename)</span><br><span class="line">        fs.<span class="title function_">readFile</span>(<span class="string">&quot;static&quot;</span>+filename,<span class="keyword">function</span>(<span class="params">err,data</span>)&#123;</span><br><span class="line">            <span class="comment">//如果文件读取失败，返回一下文字</span></span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                resp.<span class="title function_">writeHead</span>(<span class="number">404</span>,&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;text/plain;charset=utf-8&quot;</span>&#125;);</span><br><span class="line">                resp.<span class="title function_">end</span>(<span class="string">&quot;您访问的页面不存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果文件读取成功，返回文件内容以及对应的响应格式</span></span><br><span class="line">            <span class="keyword">let</span> mine = common.<span class="title function_">getMine</span>(extname);</span><br><span class="line">            resp.<span class="title function_">writeHead</span>(<span class="number">200</span>,&#123;<span class="string">&quot;Content-Type&quot;</span>:mine+<span class="string">&quot;;charset=utf-8&quot;</span>&#125;);</span><br><span class="line">            resp.<span class="title function_">end</span>(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8081</span>);</span><br></pre></td></tr></table></figure>
<h2 id="4、post表单数据获取"><a href="#4、post表单数据获取" class="headerlink" title="4、post表单数据获取"></a>4、post表单数据获取</h2><p>在node中获取post数据使用到以下中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)	</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())			<span class="comment">//设置接收axios applicate/json类型	实测没用，最好还是确保类型是application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))		<span class="comment">//自动将post参数转换为对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">***	示例如下</span></span><br><span class="line"><span class="comment">***</span></span><br><span class="line"><span class="comment">***/</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/updata&quot;</span>,<span class="function">(<span class="params">req,resp</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> msg = req.<span class="property">body</span>[<span class="string">&quot;msg&quot;</span>]</span><br><span class="line">    resp.<span class="title function_">send</span>(<span class="string">&quot;您提交的信息是:&quot;</span>+msg)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>html中的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:8001/updata&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;msg&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5、cookie的获取"><a href="#5、cookie的获取" class="headerlink" title="5、cookie的获取"></a>5、cookie的获取</h2><p>cookie的获取也需要导入<strong>cookie-parser</strong>的模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	其中，resp.cookie中&#123;&#125;包含以下参数</span></span><br><span class="line"><span class="comment">	maxAge：cookie有效时间，单位毫秒</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/chick&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,resp</span>)&#123;</span><br><span class="line">	resp.<span class="title function_">cookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;张三&quot;</span>,&#123;<span class="attr">maxAge</span>:<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>&#125;)	<span class="comment">//第三位参数是cookie的有效时间，单位毫秒(ms)</span></span><br><span class="line">	resp.<span class="title function_">send</span>(<span class="string">&quot;cookie已经添加&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/getcookie&quot;</span>,<span class="keyword">function</span>(<span class="params">req,resp</span>)&#123;</span><br><span class="line">    <span class="comment">//console.log(req.cookies[&quot;username&quot;])</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">cookies</span>)</span><br><span class="line">    resp.<span class="title function_">send</span>(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line">    <span class="comment">//resp.send(&quot;您的cookie是:&quot;+req.cookies.username)</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>加密cookie</strong>，作用：用于传递一些中文cookie，先加密，需要的时候解密</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>)</span><br><span class="line"><span class="comment">//配置cookieParser中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>(<span class="string">&quot;abcdef&quot;</span>))		<span class="comment">//传入加密密钥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//加密设置</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/setcookie&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;muouren7&quot;</span>,&#123;<span class="attr">maxAge</span>:<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>,<span class="attr">signed</span>:<span class="literal">true</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取加密后的cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;getcookie&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">signedCookies</span>[<span class="string">&quot;username&quot;</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="6、跨域"><a href="#6、跨域" class="headerlink" title="6、跨域"></a>6、跨域</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置允许跨域访问该服务</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;*&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>,<span class="string">&quot;http://localhost:8081&quot;</span>);		<span class="comment">//放行的域</span></span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>,<span class="string">&quot;PUT,GET,POST,DELETE,OPTIONS&quot;</span>);	<span class="comment">//放行的方法</span></span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,<span class="string">&quot;X-Requestd-With&quot;</span>);	</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,<span class="string">&quot;Content-Type&quot;</span>);	</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>,<span class="literal">true</span>);			<span class="comment">//是否可以传递cookie，如果为true，那么第一项里必须为具体的域名，不能为*</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="7、session的使用"><a href="#7、session的使用" class="headerlink" title="7、session的使用"></a>7、session的使用</h2><p>首先需要安装<strong>express-session</strong>的包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session --save</span><br></pre></td></tr></table></figure>
<p>引入包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>设置官方文档提供的中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>:<span class="string">&#x27;keyboard cat&#x27;</span>,		<span class="comment">//服务端生成session的签名，里面的字符串随便写</span></span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;session_id&quot;</span>,			<span class="comment">//修改cookie中对应session-key的名称</span></span><br><span class="line">    <span class="attr">resave</span>:<span class="literal">true</span>,				<span class="comment">//强制保存session</span></span><br><span class="line">    <span class="attr">saveUninitialized</span>:<span class="literal">true</span>,		<span class="comment">//强制将未初始化的session存储</span></span><br><span class="line">    <span class="attr">cookie</span>:&#123;</span><br><span class="line">        <span class="attr">maxAge</span>:<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>,	</span><br><span class="line">        <span class="attr">secure</span>:<span class="literal">false</span>		<span class="comment">//true表示只有https连接才能访问session		</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rolling</span>:<span class="literal">true</span>		<span class="comment">//每次登录重新把cookie的过期时间设置为maxAge</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p>session的使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置session</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/setsession&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">username</span> = <span class="string">&quot;muouren7&quot;</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;session已经存储&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//获取session</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/getsession&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name = req.<span class="property">session</span>.<span class="property">username</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;您的session是---&quot;</span>+name)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//销毁session</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/destroySession&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//方法1 将保存session的cookie时间设置为0，销毁全部session</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="property">cookie</span>.<span class="property">maxAge</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法2 销毁指定session</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="property">username</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法3 destroy</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="title function_">destroy</span>()</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="8、将session保存在mongoDB"><a href="#8、将session保存在mongoDB" class="headerlink" title="8、将session保存在mongoDB"></a>8、将session保存在mongoDB</h2><p>导入<strong>connect-mongo</strong>的包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MongoStore</span> = <span class="built_in">require</span>(<span class="string">&quot;connect-mongo&quot;</span>)(session)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">user</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">store</span>: <span class="title class_">MongoStore</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;你的mongoDb数据库地址&quot;</span>,</span><br><span class="line">        <span class="attr">touchAfter</span>:<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>				<span class="comment">//不管发出多少请求，24小时内只更新一次session</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<h2 id="9、路由模块化"><a href="#9、路由模块化" class="headerlink" title="9、路由模块化"></a>9、路由模块化</h2><p>将单个js文件内的路由拆分成多个js文件，可以理解为模块化<br>主文件<strong>app.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&quot;express&quot;)</span><br><span class="line">var app = express()</span><br><span class="line"></span><br><span class="line">//引入模块admin.js，这里admin.js与app.js位于同一级目录下</span><br><span class="line">var admin = require(&quot;admin&quot;)</span><br><span class="line">//配置中间件</span><br><span class="line">app.use(&quot;/admin&quot;,admin)</span><br><span class="line"></span><br><span class="line">app.listen(8080,()=&gt;&#123;</span><br><span class="line">    console.log(&quot;已经在端口8080开启服务&quot;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>模块文件<strong>admin.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//url:http:127.0.0.1:8080/admin</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;您已来到管理员模块&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//url:http:127.0.0.1:8080/admin/manage</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/manage&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;您正在管理admin模块&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure>
<h2 id="10、结合multer上传图片"><a href="#10、结合multer上传图片" class="headerlink" title="10、结合multer上传图片"></a>10、结合multer上传图片</h2><p>安装<strong>multer</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save multer</span><br></pre></td></tr></table></figure>
<p>html代码如下，form表单中格式必须为<strong>multipart&#x2F;form-data</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=&quot;http://127.0.0.1:8080/profile&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;file&quot; name=&quot;pic&quot; &gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><strong>app.js</strong>中代码如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&quot;multer&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = multer.<span class="title function_">diskStorage</span>(&#123;</span><br><span class="line">    <span class="comment">//配置文件上传位置</span></span><br><span class="line">    <span class="attr">destination</span>: <span class="keyword">function</span> (<span class="params">req, file, cb</span>) &#123;</span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, <span class="string">&#x27;/static/files&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//修改上传文件的后缀名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="keyword">function</span> (<span class="params">req, file, cb</span>) &#123;</span><br><span class="line">        <span class="comment">//获取后缀名</span></span><br><span class="line">        <span class="keyword">let</span> extname = path.<span class="title function_">extname</span>(file[<span class="string">&quot;originalname&quot;</span>])</span><br><span class="line">        <span class="comment">//设置后缀名</span></span><br><span class="line">        <span class="keyword">const</span> uniqueSuffix = <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="string">&#x27;-&#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">1E9</span>)</span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, file.<span class="property">fieldname</span> + <span class="string">&#x27;-&#x27;</span> + uniqueSuffix + extname)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123; <span class="attr">storage</span>: storage &#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/profile&quot;</span>,upload.<span class="title function_">single</span>(<span class="string">&#x27;pic&#x27;</span>),<span class="function">(<span class="params">req,res,nex</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">file</span>)</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">file</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="11、node-js连接mongoDB"><a href="#11、node-js连接mongoDB" class="headerlink" title="11、node.js连接mongoDB"></a>11、node.js连接mongoDB</h2><p>如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MongoClinet</span> = <span class="built_in">require</span>(<span class="string">&quot;mongodb&quot;</span>).<span class="property">MongoClient</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DataBaseUrl</span> = <span class="string">&quot;mongodb://127.0.0.1:27017/&quot;</span>		<span class="comment">//mongoDB数据库地址</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/chick&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,resp</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> parse = url.<span class="title function_">parse</span>(req.<span class="property">url</span>)</span><br><span class="line">    <span class="keyword">let</span> name = parse.<span class="property">query</span>.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="title class_">MongoClinet</span>.<span class="title function_">connect</span>(<span class="title class_">DataBaseUrl</span>,<span class="keyword">function</span>(<span class="params">err,db</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据库连接错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> dbo = db.<span class="title function_">db</span>(<span class="string">&quot;itying&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> data = &#123;<span class="string">&quot;name&quot;</span>:<span class="built_in">unescape</span>(name)&#125;</span><br><span class="line">        <span class="keyword">let</span> msg = dbo.<span class="title function_">collection</span>(<span class="string">&quot;user&quot;</span>).<span class="title function_">find</span>(data).<span class="title function_">toArray</span>(<span class="function">(<span class="params">err,result</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;查询出错&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            resp.<span class="title function_">cookie</span>(<span class="string">&quot;username&quot;</span>,result[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>],&#123;<span class="attr">maxAge</span>:<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>&#125;)</span><br><span class="line">            resp.<span class="title function_">send</span>(result)</span><br><span class="line">            db.<span class="title function_">close</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="Mongoose使用"><a href="#Mongoose使用" class="headerlink" title="Mongoose使用"></a>Mongoose使用</h1><h2 id="1、Demo"><a href="#1、Demo" class="headerlink" title="1、Demo"></a>1、Demo</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&quot;mongodb://127.0.0.1:27017/itying&quot;</span>)  <span class="comment">//把数据库名字也加上</span></span><br><span class="line"><span class="comment">//操作users表 定义一个Schema</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">UserSchema</span> = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="title class_">Number</span>,</span><br><span class="line">    status,<span class="title class_">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//定义model，第一个参数（表名必须为第一个参数的复数形式，且参数首字母必须大写），第二参数为定义的Schema，第三个参数（如果有，则对应此参数对应的集合，没有则是以第一个参数为准）</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>,<span class="title class_">UserSchema</span>,<span class="string">&quot;users&quot;</span>)</span><br><span class="line"><span class="comment">//查询users集合的数据，第一个参数为过滤条件</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>(&#123;&#125;,<span class="function">(<span class="params">err,doc</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    	<span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="property">log</span>	(doc)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="2、增加一条数据"><a href="#2、增加一条数据" class="headerlink" title="2、增加一条数据"></a>2、增加一条数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> u = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;muouren7&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">22</span></span><br><span class="line">&#125;)</span><br><span class="line">u.<span class="title function_">save</span>(<span class="function">(<span class="params">err,msg</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err:&quot;</span>+err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(msg)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;msg:&quot;</span>+msg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)    <span class="comment">//执行增加操作，回调函数可加可不加，msg为user的json数据</span></span><br></pre></td></tr></table></figure>
<h2 id="3、查询数量"><a href="#3、查询数量" class="headerlink" title="3、查询数量"></a>3、查询数量</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2、查询users表数量，第一个&#123;&#125;中为过滤条件</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">countDocuments</span>(&#123;&#125;,<span class="function">(<span class="params">err,num</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回值是:&quot;</span>+num)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="4、修改数据记录"><a href="#4、修改数据记录" class="headerlink" title="4、修改数据记录"></a>4、修改数据记录</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4、修改数据记录，参数1表示修改的条件，参数2表示修改的内容</span></span><br><span class="line"><span class="comment">//例：将名字为张三的改为张三1234</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">updateOne</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;张三1234&quot;</span>&#125;,<span class="function">(<span class="params">err,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="5、删除数据"><a href="#5、删除数据" class="headerlink" title="5、删除数据"></a>5、删除数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5、删除记录</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">deleteOne</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;,<span class="function">(<span class="params">err,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;删除成功&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><h2 id="1、数据库的创建、使用"><a href="#1、数据库的创建、使用" class="headerlink" title="1、数据库的创建、使用"></a>1、数据库的创建、使用</h2><p>在cmd下运行，直接切换到数据库不能创建成功，必须插入一条数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use itying 		###创建名为itying的数据库</span><br></pre></td></tr></table></figure>
<p>往itying数据库的user集合里插入一条数据（集合不用创建，直接操作）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use itying		###切换到itying数据库下</span><br><span class="line">db.user.insert(&#123;&quot;name&quot;:&quot;xiaoming&quot;,&quot;age&quot;:20&#125;);</span><br><span class="line"></span><br><span class="line">show collections	###展示当前数据库里所有的集合</span><br><span class="line">db.user.find()		###展示user集合下的数据</span><br><span class="line"></span><br><span class="line">show dbs	### 展示当前所有的数据库</span><br></pre></td></tr></table></figure>
<h2 id="2、删除集合"><a href="#2、删除集合" class="headerlink" title="2、删除集合"></a>2、删除集合</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 切换到itying数据库下</span></span></span><br><span class="line">use itying</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##删除user集合</span></span></span><br><span class="line">db.user.drop()</span><br></pre></td></tr></table></figure>
<h2 id="3、删除数据库"><a href="#3、删除数据库" class="headerlink" title="3、删除数据库"></a>3、删除数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 切换到itying数据库下</span></span></span><br><span class="line">use itying</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 删除当前数据库</span></span></span><br><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure>
<h2 id="4、插入数据"><a href="#4、插入数据" class="headerlink" title="4、插入数据"></a>4、插入数据</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.表名.insert(&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:20&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="5、查询"><a href="#5、查询" class="headerlink" title="5、查询"></a>5、查询</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	1、查询所有记录</span></span></span><br><span class="line">db.user.find()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	2、查找age=22的数据</span></span></span><br><span class="line">db.user.find(&#123;&quot;age&quot;:22&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	3、查询age&gt;22的记录</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$gt:22&#125;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	4、查询age&lt;22的记录</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$lt:22&#125;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	5、查询age&gt;=25的记录</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$gte:25&#125;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	6、查询age&lt;=25的记录</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$lte:25&#125;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	7、查询age&gt;=23 并且 age&lt;=26</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$gte:23,$lte:26&#125;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	8、查询name中包含mongo的数据	模糊查询</span></span></span><br><span class="line">db.user.find(&#123;name:/mongo/&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	9、查询name中以mongo开头的数据</span></span></span><br><span class="line">db.user.find(&#123;name:/^mongo/&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	10、查询指定列,只显示name，不显示age，第一个&#123;&#125;为条件参数</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$lte:25&#125;&#125;,&#123;name:1&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 11、按照年龄排序，1：升序	2：降序</span></span></span><br><span class="line">db.user.find().sort(&#123;age:1&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 12、查询前5条数据</span></span></span><br><span class="line">db.user.find().limit(5)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	13、查询10条以后的数据</span></span></span><br><span class="line">db.user.find().skip(10)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 14、查询5-10之间的数据</span></span></span><br><span class="line">db.user.find().limit(10).skip(5)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 15、or查询,查22或者25</span></span></span><br><span class="line">db.user.find(&#123;$or:[&#123;age:22&#125;,&#123;age:25&#125;]&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 16、统计age&gt;25的个数</span></span></span><br><span class="line">db.user.find(&#123;age:&#123;$gt:25&#125;&#125;).count()</span><br></pre></td></tr></table></figure>
<h2 id="6、修改"><a href="#6、修改" class="headerlink" title="6、修改"></a>6、修改</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	1、把名字叫做小明的年龄改为16</span></span></span><br><span class="line">db.user.update(&#123;&quot;name&quot;:&quot;小明&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:16&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="7、删除"><a href="#7、删除" class="headerlink" title="7、删除"></a>7、删除</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 1、删除age为26的</span></span></span><br><span class="line">db.user.remove(&#123;age:26&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="8、设置索引与复合索引（面临海量数据时提升查询速度）"><a href="#8、设置索引与复合索引（面临海量数据时提升查询速度）" class="headerlink" title="8、设置索引与复合索引（面临海量数据时提升查询速度）"></a>8、设置索引与复合索引（面临海量数据时提升查询速度）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	对username字段设置索引，1：升序		2：降序</span></span></span><br><span class="line">db.user.ensureIndex(&#123;&quot;username&quot;:1&#125;)</span><br><span class="line">db.user.createIndex(&#123;&quot;username&quot;:1&#125;)		##新版mongo命令</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	获取当前已经设置的索引</span></span></span><br><span class="line">db.user.getIndexes()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	删除索引</span></span></span><br><span class="line">db.user.dropIndex(&#123;&quot;username&quot;:1&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 复合索引</span></span></span><br><span class="line">db.user.ensureIndex(&#123;&quot;usernam&quot;:1,&quot;age&quot;:-1&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	设置唯一索引（必须唯一）</span></span></span><br><span class="line">db.user.exsureIndex(&#123;&quot;userid&quot;:1&#125;,&#123;&quot;unique&quot;:true&#125;)		###	设置userid为唯一索引，数据库中不能存在相同的userid</span><br></pre></td></tr></table></figure>
<h2 id="9、mongo权限配置"><a href="#9、mongo权限配置" class="headerlink" title="9、mongo权限配置"></a>9、mongo权限配置</h2><p>1、创建超级管理员用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">	user:&#x27;admin&#x27;,</span><br><span class="line">	pwd:&#x27;123456&#x27;,</span><br><span class="line">	roles:[&#123;role:&#x27;root&#x27;,db:&#x27;admin&#x27;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>2、修改mongodb安装目录下的配置文件mongod.cfg文件，添加以下配置，开启连接验证，然后重启mongodb服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">	authorization: enabled;</span><br></pre></td></tr></table></figure>
<p>3、用超级管理员用户密码连接数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongo admin -u 用户名 -p 密码</span><br><span class="line">mongo 127.0.0.1:27017/test -u user -p pwd</span><br></pre></td></tr></table></figure>
<p>4、给eggcms数据库创建一个用户，只能访问eggcms不能访问其他数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user eggcms</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">	user:&#x27;eggadmin&#x27;,</span><br><span class="line">	pwd:&#x27;123456&#x27;,</span><br><span class="line">	roles:[&#123;role:&#x27;dbOwner&#x27;,db:&#x27;eggcms&#x27;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="MongoDb数据库角色"><a href="#MongoDb数据库角色" class="headerlink" title="MongoDb数据库角色"></a>MongoDb数据库角色</h2><p>1、数据库用户角色：read、readWrite<br>2、数据库管理角色：dbAdmin、dbOwner、userAdmin</p>
<p>3、集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager</p>
<p>4、备份恢复角色：backup、restore</p>
<p>5、所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</p>
<p>6、超级用户：root</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 查看当前库下的管理员</span></span></span><br><span class="line">show user</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	删除用户</span></span></span><br><span class="line">db.dropUser(&quot;eggadmin&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##	修改用户密码</span></span></span><br><span class="line">db.updateUser(&quot;admin&quot;,&#123;pwd:&#x27;password&#x27;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 密码认证</span></span></span><br><span class="line">db.auth(&quot;admin&quot;,&quot;password&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>














        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/muouren7">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






</html>
